<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Pygraph redis by kakwa</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/kakwa/pygraph_redis">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/kakwa/pygraph_redis/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/kakwa/pygraph_redis/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Pygraph redis</h1>
          <p>Simple python library to manipulate directed graphs in redis</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/kakwa">kakwa</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <h1>pygraph_redis  <a href="https://travis-ci.org/kakwa/pygraph_redis"><img src="https://api.travis-ci.org/kakwa/pygraph_redis.png" alt="Build Status"></a>
</h1>

<p>Simple python library to manipulate directed graphs in redis</p>

<h1>License</h1>

<p>pygraph_redis is released under the MIT Public License</p>

<h1>Description</h1>

<p>pygraph_redis is a simple library to manipulate directed graphs inside a redis database.</p>

<p>In this library, a graph is a bunch of nodes, each node knows its predecessors 
and its successors. A node can store some attributs (strings or sets of strings).</p>

<h1>Dependancies</h1>

<p>pygraph_redis relies on <a href="https://github.com/antirez/redis">redis</a> and <a href="https://github.com/andymccurdy/redis-py">redis-py</a>.</p>

<p>For atomicity of transaction, it requires lua scripting support (redis-py &gt;= 2.7.0 and redis &gt;= 2.6.0), but it provides a legacy mode, without atomicity for older redis and redis-py.</p>

<h1>Write atomicity</h1>

<p>With proper versions, pygraph_redis provided the atomicity of transaction when adding or removing a node.</p>

<h1>Installation</h1>

<p>to install:</p>

<div class="highlight"><pre>python setup.py install
</pre></div>

<h1>How to use</h1>

<p>First you need a redis database, it's up to you to install it.</p>

<p>The library itself is quite simple:</p>

<h2>Cheat Sheet</h2>

<div class="highlight"><pre><span class="c">#              initialization</span>
<span class="c">#       arg1      |    arg2    |     arg3</span>
<span class="c">#--------------------------------------------</span>
<span class="c"># redis connexion | graph_name |    logger</span>
<span class="c">#    redis obj    |  unicode   |  logger obj </span>

<span class="n">mygraph1</span> <span class="o">=</span> <span class="n">Directed_graph</span><span class="p">(</span><span class="n">r_server</span><span class="p">,</span> <span class="s">u'mygraph1'</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

<span class="c">#optional args:</span>
<span class="c">#   arg4    |    arg5  </span>
<span class="c">#-----------------------</span>
<span class="c"># separator | has_root </span>
<span class="c"># unicode   |   bool   </span>

<span class="n">mygraph1</span> <span class="o">=</span> <span class="n">Directed_graph</span><span class="p">(</span><span class="n">r_server</span><span class="p">,</span> 
    <span class="s">u'mygraph1'</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="s">u'mysep'</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="c">#                    create or add elements to a node</span>
<span class="c">#    arg1   |     arg2     |     arg3     |             arg4</span>
<span class="c">#---------------------------------------------------------------------------</span>
<span class="c"># node name |  successors  | predecessors |           attributs</span>
<span class="c">#  unicode  | unicode list | unicode list |      dictionnary of unicode </span>
<span class="c">#           |              |              | or set of unicode (key: unicode)</span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">write_on_node</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">,</span> 
                       <span class="p">[</span><span class="s">u's2'</span><span class="p">],</span>
                       <span class="p">[</span><span class="s">u'p1'</span><span class="p">],</span> 
                       <span class="p">{</span><span class="s">u'a3'</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s">u'69'</span><span class="p">]),</span> <span class="s">u'a2'</span><span class="p">:</span> <span class="s">u'42'</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="c">#             delete elements from a node</span>
<span class="c">#    arg1   |     arg2     |     arg3     |      arg4</span>
<span class="c">#----------------------------------------------------------</span>
<span class="c"># node name |  successors  | predecessors | attributs names</span>
<span class="c">#  unicode  | unicode list | unicode list | list of unicode </span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">write_off_node</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">,</span> <span class="p">[</span><span class="s">u's2'</span><span class="p">],</span> <span class="p">[</span><span class="s">u'p1'</span><span class="p">],</span> <span class="p">[</span><span class="s">u'attr3'</span><span class="p">,</span> <span class="s">u'attr2'</span><span class="p">]</span>
</pre></div>

<div class="highlight"><pre><span class="c"># delete a node</span>
<span class="c">#     arg1 </span>
<span class="c">#--------------</span>
<span class="c">#  node name </span>
<span class="c">#   unicode   </span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="c"># get attributs list</span>
<span class="c">#     arg1 </span>
<span class="c">#--------------</span>
<span class="c">#  node name </span>
<span class="c">#   unicode   </span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">get_attributs_list</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="c"># get an attribut</span>
<span class="c">#     arg1     |     arg2</span>
<span class="c">#--------------|--------------</span>
<span class="c">#  node name   | attribut name</span>
<span class="c">#   unicode    |    unicode</span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">get_attribut</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">,</span> <span class="s">u'a2'</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="c"># get an attribut length</span>
<span class="c">#     arg1     |     arg2</span>
<span class="c">#--------------|--------------</span>
<span class="c">#  node name   | attribut name</span>
<span class="c">#   unicode    |    unicode</span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">get_attribut_len</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">,</span> <span class="s">u'a2'</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="c"># get successors</span>
<span class="c">#     arg1 </span>
<span class="c">#--------------</span>
<span class="c">#  node name </span>
<span class="c">#   unicode   </span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">get_successors</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="c"># get predecessors</span>
<span class="c">#     arg1 </span>
<span class="c">#--------------</span>
<span class="c">#  node name </span>
<span class="c">#   unicode   </span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">get_predecessors</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">)</span>
</pre></div>

<h2>Initialization</h2>

<p>Create an instance of "Directed_graph":</p>

<div class="highlight"><pre><span class="c">#importing directed_graph</span>
<span class="kn">from</span> <span class="nn">pygraph_redis.directed_graph</span> <span class="kn">import</span> <span class="n">Directed_graph</span>
<span class="kn">import</span> <span class="nn">redis</span>

<span class="c">#creating a basic logger</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">format</span> <span class="o">=</span> <span class="s">u'</span><span class="si">%(message)s</span><span class="s">'</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">u'redis'</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c">#creating the redis connexion</span>
<span class="n">r_server</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">)</span>

<span class="c">#creating the graph object</span>
<span class="n">mygraph1</span> <span class="o">=</span> <span class="n">Directed_graph</span><span class="p">(</span><span class="n">r_server</span><span class="p">,</span> <span class="s">u'mygraph1'</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

<span class="c">#creating the graph object with a different separator</span>
<span class="n">mygraph2</span> <span class="o">=</span> <span class="n">Directed_graph</span><span class="p">(</span><span class="n">r_server</span><span class="p">,</span> <span class="s">u'mygraph2'</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">separator</span> <span class="o">=</span> <span class="s">u'mysep'</span><span class="p">)</span>

<span class="c">#creating the graph object with a "root" (improper name, I know)</span>
<span class="n">mygraph2</span> <span class="o">=</span> <span class="n">Directed_graph</span><span class="p">(</span><span class="n">r_server</span><span class="p">,</span> <span class="s">u'mygraph2'</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">has_root</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="c">#"has_root = True" ensures that every node has a predecessor</span>
<span class="c">#if enabled, a node has at least root as a predecessor, </span>
<span class="c">#but if it has any other predecessor it doesn't have root as predecessor</span>
</pre></div>

<h2>Node manipulation</h2>

<p>Node creation:</p>

<div class="highlight"><pre><span class="c">#add node 'm1' to 'mygraph1' with:</span>
<span class="c">#successors: 's1' and 's2'</span>
<span class="c">#predecessors: 'p1' and 'p2'</span>
<span class="c">#attributs:</span>
<span class="c">#   * 'attr1': set([u'51',u'69'])</span>
<span class="c">#   * 'attr2': '42'    </span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">write_on_node</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">,</span>
    <span class="p">[</span><span class="s">u's1'</span><span class="p">,</span> <span class="s">u's2'</span><span class="p">],</span>
    <span class="p">[</span><span class="s">u'p1'</span><span class="p">,</span> <span class="s">u'p2'</span><span class="p">],</span>
    <span class="p">{</span><span class="s">u'attr1'</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s">u'51'</span><span class="p">,</span> <span class="s">u'69'</span><span class="p">]),</span> <span class="s">u'attr2'</span><span class="p">:</span> <span class="s">u'42'</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>

<p>About <code>successors</code> and <code>predecessors</code>, if node was already declared as a predecessor of one 
of its successors, it's not necessary to add this successor in node successors set.
Same with <code>predecessors</code>.</p>

<p>example:</p>

<div class="highlight"><pre><span class="n">mygraph1</span><span class="o">.</span><span class="n">write_on_node</span><span class="p">(</span><span class="s">u'pred'</span><span class="p">,</span>
    <span class="p">[</span><span class="s">u'succ'</span><span class="p">],</span>
    <span class="p">[],</span>
    <span class="p">{}</span>
<span class="p">)</span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">write_on_node</span><span class="p">(</span><span class="s">u'succ'</span><span class="p">,</span>
    <span class="p">[],</span>
    <span class="p">[],</span>
    <span class="p">{}</span>
<span class="p">)</span>
</pre></div>

<p>Gives the same result that:</p>

<div class="highlight"><pre><span class="n">mygraph1</span><span class="o">.</span><span class="n">write_on_node</span><span class="p">(</span><span class="s">u'pred'</span><span class="p">,</span>
    <span class="p">[</span><span class="s">u'succ'</span><span class="p">],</span>
    <span class="p">[],</span>
    <span class="p">{}</span>
<span class="p">)</span>

<span class="n">mygraph1</span><span class="o">.</span><span class="n">write_on_node</span><span class="p">(</span><span class="s">u'succ'</span><span class="p">,</span>
    <span class="p">[],</span>
    <span class="p">[</span><span class="s">u'pred'</span><span class="p">],</span>
    <span class="p">{}</span>
<span class="p">)</span>
</pre></div>

<p>Node edition:</p>

<div class="highlight"><pre><span class="c">#add new elements or edit existing elements of a node</span>
<span class="c">#it's exactly the same function as before</span>
<span class="n">mygraph1</span><span class="o">.</span><span class="n">write_on_node</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">,</span> 
    <span class="p">[</span><span class="s">u's4'</span><span class="p">],</span> 
    <span class="p">[],</span> 
    <span class="p">{</span><span class="s">u'attr3'</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s">u'16'</span><span class="p">,</span> <span class="s">u'32'</span><span class="p">,</span> <span class="s">u'64'</span><span class="p">]),</span> <span class="s">u'attr2'</span><span class="p">:</span> <span class="s">u'5150'</span><span class="p">}</span>
<span class="p">)</span>

<span class="c">#remove some elements of a node (successors, predecessors, attributs)</span>
<span class="n">mygraph1</span><span class="o">.</span><span class="n">write_off_node</span><span class="p">(</span><span class="s">u"m1"</span><span class="p">,</span> <span class="p">[</span><span class="s">u"s1"</span><span class="p">],</span> <span class="p">[</span><span class="s">u"p2"</span><span class="p">],[</span><span class="s">u'attr2'</span><span class="p">])</span>

<span class="c">#completely delete a node</span>
<span class="n">mygraph1</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="s">u'm1'</span><span class="p">)</span>
</pre></div>

<h2>Node attributs manipulation</h2>

<p>To manipulate the attributs of a node:</p>

<div class="highlight"><pre><span class="c">#create the node 'm2'</span>
<span class="n">mygraph1</span><span class="o">.</span><span class="n">write_on_node</span><span class="p">(</span><span class="s">u'm2'</span><span class="p">,</span>
    <span class="p">[</span><span class="s">u's1'</span><span class="p">,</span> <span class="s">u's2'</span><span class="p">],</span>
    <span class="p">[</span><span class="s">u'p1'</span><span class="p">,</span> <span class="s">u'p2'</span><span class="p">],</span>
    <span class="p">{</span><span class="s">u'attr1'</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s">u'51'</span><span class="p">,</span> <span class="s">u'69'</span><span class="p">]),</span> <span class="s">u'attr2'</span><span class="p">:</span> <span class="s">u'42'</span><span class="p">}</span>
<span class="p">)</span>

<span class="c">#get the set of attribut names</span>
<span class="n">set_of_attributs</span> <span class="o">=</span> <span class="n">mygraph1</span><span class="o">.</span><span class="n">get_attributs_list</span><span class="p">(</span><span class="s">u'm2'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">set_of_attributs</span>

<span class="c">#get a specific attribut</span>
<span class="n">attr2</span> <span class="o">=</span> <span class="n">mygraph1</span><span class="o">.</span><span class="n">get_attribut</span><span class="p">(</span><span class="s">u'm2'</span><span class="p">,</span> <span class="s">u'attr2'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">attr2</span>

<span class="c">#get a specific attribut length</span>
<span class="c"># 1 if it's a string</span>
<span class="c"># cardinal of set if it's a set</span>
<span class="c"># 0 if attribut doesn't exists</span>
<span class="n">attr2</span> <span class="o">=</span> <span class="n">mygraph1</span><span class="o">.</span><span class="n">get_attribut_len</span><span class="p">(</span><span class="s">u'm2'</span><span class="p">,</span> <span class="s">u'attr2'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">attr2</span>

</pre></div>

<h2>Graph navigation</h2>

<p>To navigate inside the graph, you have two functions:</p>

<div class="highlight"><pre><span class="c">#get the predecessors of 'm2'</span>
<span class="n">predecessors</span> <span class="o">=</span> <span class="n">mygraph1</span><span class="o">.</span><span class="n">get_predecessors</span><span class="p">(</span><span class="s">u'm2'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">predecessors</span>

<span class="c">#get the successors of 'm2'</span>
<span class="n">successors</span> <span class="o">=</span> <span class="n">mygraph1</span><span class="o">.</span><span class="n">get_successors</span><span class="p">(</span><span class="s">u'm2'</span><span class="p">)</span>
</pre></div>

<p>if you have the <code>has_root</code> flag enable:</p>

<div class="highlight"><pre><span class="c">#get the "root" name</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">mygraph1</span><span class="o">.</span><span class="n">get_root_name</span><span class="p">()</span>

<span class="k">print</span> <span class="n">root</span>

<span class="c">#get the successors of 'root'</span>
<span class="n">successors</span> <span class="o">=</span> <span class="n">mygraph1</span><span class="o">.</span><span class="n">get_successors</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="k">print</span> <span class="n">successors</span>

</pre></div>

<h2>About the redis keys</h2>

<p>Redis key format:</p>

<pre><code>  &lt;graph name&gt;&lt;sep&gt;&lt;node_name&gt;&lt;sep&gt;&lt;variable_name&gt;[&lt;sep&gt;&lt;other&gt;]*

  &lt;graph name&gt;: name of the graph
  &lt;sep&gt;: the key fields separator 
       (this string should not be in node_name or variable_name,
        otherwise, there is a redis key collision possibility)
  &lt;node_name&gt;: name of the node
  &lt;variable_name&gt;: name of the variable
  [&lt;sep&gt;&lt;other&gt;]: optional extension
</code></pre>

<p>To avoid key collision, you must carefully choose the key separator,
it must not be included in any node name or node attribut name (possible redis key collision).</p>

<h2>About the logs</h2>

<p>This library provides a lot of logs, mainly debug, some info (ex: legacy modes), some warning (ex: possible key collision)</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>